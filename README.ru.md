[![en](https://img.shields.io/badge/lang-EN-blue.svg)](https://github.com/CompPhysLab/SVETlANNa/blob/main/README.md)
[![ru](https://img.shields.io/badge/lang-RU-green.svg)](https://github.com/CompPhysLab/SVETlANNa/blob/main/README.ru.md)

# SVETlANNa

SVETlANNa — это библиотека на языке Python с открытым исходным кодом для моделирования распространения оптических пучков в оптических схемах в свободном пространстве и нейроморфных систем, таких как дифракционные нейронные сети. Библиотека основана на фреймворке PyTorch, используя его ключевые возможности, такие как тензорные вычисления и эффективная параллельная обработка данных. В своей основе SVETlANNa опирается на Фурье-оптику, поддерживая несколько моделей распространения, включая метод углового спектра и приближение Френеля.

Сопровождающий проект на github [SVETlANNa.docs](https://github.com/CompPhysLab/SVETlANNa.docs) содержит различные примеры использования библиотеки в формате блокнотов Jupyter.

Название библиотеки образовано от русского слова «свет» и аббревиатуры ANN, что означает искусственная нейронная сеть, и одновременно все слово звучит как русское женское имя Светлана.

## Сокращения

- НС - нейронная сеть
- ИНС - искусственная нейронная сеть
- ОНС - оптическая нейронная сеть
- ДОНС - дифракционная оптическая нейронная сеть
- ДОЭ - дифракционный оптический элемент
- SLM - пространственный модулятор света

## Особенности библиотеки

- основана на [PyTorch](https://pytorch.org/)
- реализация модели прямого распространения света методом углового спектра (Angular spectrum method) и в приближении Френеля (Fresnel approximation)
- возможность решать ДОЭ/SLM задачи оптимизации при помощи алгоритма Гершберга–Сакстона и hybrid input-output (HIO) алгоритма
- поддержка пользовательских элементов и методов оптимизации
- поддержка различных архитектур ОНС, включая нейронные сети с прямой связью, автоэнкодеры и рекуррентные нейронные сети
- кроссплатформенность 
- полная поддержка расчетов на видеоускорителях (GPU)
- дополнительный репозиторий с .ipynb примерами
- дополнительные инструменты логирования, управления проектами, анализа и визуализации
- покрытие тестами кода библиотеки 

## Перечень направлений прикладного использования

- моделирование и оптимизация оптических систем и оптических пучков, распространяющихся в свободном пространстве;
- расчет параметров фазовых масок, ДОЭ и SLM как для классических оптических систем, так и для нейроморфных оптических вычислителей;
- моделирование и оптимизация параметров ОНС и ДОНС для задач полностью оптической классификации и прогнозирования.

## Рекомендуемые минимальные технические требования для запуска и использования библиотеки:

1.	процессор Intel Core i5 8400 / AMD Ryzen 5 1400 или выше;
2.	оперативная память не менее 8 Гб;
3.	свободного места на диске не менее 16 Гб (виртуальное окружение занимает около 6 Гб);
4.	при запуске расчетов на видеокарте требуется карта Nvidia с поддержкой CUDA и памятью не менее 2 Гб;
5.	операционная система Windows версии не ниже 10 или Linux с версией ядра не ниже 5.15;
6.	библиотека работает на версии Python 3.11, поддерживает версию PyTorch от `2.3.0` до `2.7.1` включительно.

# Установка, использование и примеры

Чтобы использовать библиотеку есть две опции установки: из PyPI и из исходных файлов.

## Установка из PyPI
1. 
   Создайте виртуальное окружение для Python 3.11 и активируйте его (см. документацию [venv](https://docs.python.org/3/library/venv.html)). Все последующие действия необходимо выполнять внутри активированного окружения **(это особенно важно для систем на Ubuntu и Debian, в которых запрещено устанавливать пакеты в глобальное окружение через `pip`. Попытка установить пакеты в глобальное окружение приводят к ошибкам вида `error: externally-managed-environment`)**.
2. 
   Установите библиотеку
   ```bash
   pip install svetlanna
   ```
3. 
   Установите PyTorch (см. инструкции на официальном [сайте](https://pytorch.org/get-started/locally/)). Список команд для установки версий, отличных от последней, можно найти [тут](https://pytorch.org/get-started/previous-versions/).
   Функции библиотеки протестированы на версиях PyTorch от `2.3.0` до `2.7.1` включительно. Выберите подходящий вариант установки в зависимости от вашей системы. Установка включает в себя установку модулей `torch`, `torchvision`, `torchaudio`. Для работы с GPU требуется соответствующая видеокарта и поддерживаемая сборка PyTorch. 
   При использовании GPU с поддержкой CUDA обратите внимание, что на компьютере **должна быть установлена версия CUDA, которая соответствует выбранной версии PyTorch**. Таблица соответствия версий PyTorch и версий CUDA:
   |PyTorch|CUDA|
   |-|-|
   |`2.3.0` | `11.8` `12.1`
   |`2.3.1` | `11.8` `12.1`
   |`2.4.0` | `11.8` `12.1` `12.4`
   |`2.4.1` | `11.8` `12.1` `12.4`
   |`2.5.0` | `11.8` `12.1` `12.4`
   |`2.5.1` | `11.8` `12.1` `12.4`
   |`2.6.0` | `11.8`      `12.4` `12.6`
   |`2.7.0` | `11.8`          `12.6` `12.8`
   |`2.7.1` | `11.8`           `12.6` `12.8`

   Список команд для установки версий, отличных от последней, можно найти [тут](https://pytorch.org/get-started/previous-versions/), например:
   | Видеокарта | CUDA | PyTorch | Команда для установки |
   |------------|------|-|-------------------|
   |Nvidia GTX 970|`11.8`|`2.7.1`|`pip install torch==2.7.1 torchvision==0.22.1 torchaudio==2.7.1 --index-url https://download.pytorch.org/whl/cu118`|
   |Nvidia GTX 1060|`11.8`|`2.7.1`|`pip install torch==2.7.1 torchvision==0.22.1 torchaudio==2.7.1 --index-url https://download.pytorch.org/whl/cu118`|
   |Nvidia RTX 4060|`12.8`|`2.7.1`|`pip install torch==2.7.1 torchvision==0.22.1 torchaudio==2.7.1 --index-url https://download.pytorch.org/whl/cu128`|
   <!-- * Версия Compute Capability вашей видеокарты должен поддерживаться выбранной версией PyTorch. Узнать версию Compute Capability можно на [этой странице](https://developer.nvidia.com/cuda-gpus) или для более старых версий на [этой странице](https://developer.nvidia.com/cuda-legacy-gpus). Поддерживаемые версии Compute Capability для PyTorch можно найти [тут](https://github.com/moi90/pytorch_compute_capabilities/blob/main/table.md) -->
   

## Установка из исходных файлов

Перед установкой необходимо установить [git](https://git-scm.com).

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/CompPhysLab/SVETlANNa.git
   ```
2. Перейдите в папку библиотеки:
   ```bash
   cd SVETlANNa
   ```
3. Создайте виртуальное окружение для Python 3.11 и активируйте его (см. документацию [venv](https://docs.python.org/3/library/venv.html)). Все последующие действия необходимо выполнять внутри активированного окружения **(это особенно важно для систем на Ubuntu и Debian, в которых запрещено устанавливать пакеты в глобальное окружение через `pip`. Попытка установить пакеты в глобальное окружение приводят к ошибкам вида `error: externally-managed-environment`)**.
4. Установите Poetry (версии 2.0.0 или выше):
   ```bash
   pip install poetry
   ```
5. Установите зависимости:
   ```bash
   poetry install --all-extras
   ```
6. 
   Установите PyTorch (см. инструкции на официальном [сайте](https://pytorch.org/get-started/locally/)). Список команд для установки версий, отличных от последней, можно найти [тут](https://pytorch.org/get-started/previous-versions/).
   Функции библиотеки протестированы на версиях PyTorch от `2.3.0` до `2.7.1` включительно. Выберите подходящий вариант установки в зависимости от вашей системы. Установка включает в себя установку модулей `torch`, `torchvision`, `torchaudio`. Для работы с GPU требуется соответствующая видеокарта и поддерживаемая сборка PyTorch. 
   При использовании GPU с поддержкой CUDA обратите внимание, что на компьютере **должна быть установлена версия CUDA, которая соответствует выбранной версии PyTorch**. Таблица соответствия версий PyTorch и версий CUDA:
   |PyTorch|CUDA|
   |-|-|
   |`2.3.0` | `11.8` `12.1`
   |`2.3.1` | `11.8` `12.1`
   |`2.4.0` | `11.8` `12.1` `12.4`
   |`2.4.1` | `11.8` `12.1` `12.4`
   |`2.5.0` | `11.8` `12.1` `12.4`
   |`2.5.1` | `11.8` `12.1` `12.4`
   |`2.6.0` | `11.8`      `12.4` `12.6`
   |`2.7.0` | `11.8`          `12.6` `12.8`
   |`2.7.1` | `11.8`           `12.6` `12.8`

   Список команд для установки версий, отличных от последней, можно найти [тут](https://pytorch.org/get-started/previous-versions/), например:
   | Видеокарта | CUDA | PyTorch | Команда для установки |
   |------------|------|-|-------------------|
   |Nvidia GTX 970|`11.8`|`2.7.1`|`pip install torch==2.7.1 torchvision==0.22.1 torchaudio==2.7.1 --index-url https://download.pytorch.org/whl/cu118`|
   |Nvidia GTX 1060|`11.8`|`2.7.1`|`pip install torch==2.7.1 torchvision==0.22.1 torchaudio==2.7.1 --index-url https://download.pytorch.org/whl/cu118`|
   |Nvidia RTX 4060|`12.8`|`2.7.1`|`pip install torch==2.7.1 torchvision==0.22.1 torchaudio==2.7.1 --index-url https://download.pytorch.org/whl/cu128`|

## Запуск тестов

Тесты могут быть запущены только при установке библиотеки из исходных файлов. Версия библиотеки, устанавливаемая из PyPI, не включает тесты.

**ВНИМАНИЕ**: запуск тестов требует, как минимум, 4 Гб оперативной памяти.

Для запуска тестов выполните следующую команду (в папке библиотеки при **активированном виртуальном окружении**, в котором была установлена библиотека из исходных файлов - см. выше)
```bash
pytest
```

# Документация

Документация доступна по [ссылке](https://compphyslab.github.io/SVETlANNa/)

# Запуск примеров
## Запуск примеров с установкой библиотеки из PyPI

Примеры с различными сценариями использования библиотеки собраны в репозитории [SVETlANNa.docs](https://github.com/CompPhysLab/SVETlANNa.docs).

Чтобы запустить примеры локально на вашем компьютере, выполните следующие действия:
1. Клонируйте репозиторий с примерами (должен быть установлен [git](https://git-scm.com)):
   ```bash
   git clone https://github.com/CompPhysLab/SVETlANNa.docs.git
   ```
2. Перейдите в директорию репозитория с примерами:
   ```bash
   cd SVETlANNa.docs
   ```
3. Создайте виртуальное окружение для Python 3.11 и активируйте его (см. документацию [venv](https://docs.python.org/3/library/venv.html)). Все последующие действия необходимо выполнять внутри активированного окружения **(это особенно важно для систем на Ubuntu и Debian, в которых запрещено устанавливать пакеты в глобальное окружение через `pip`. Попытка установить пакеты в глобальное окружение приводят к ошибкам вида `error: externally-managed-environment`)**.
4. Установите библиотеку:
   ```bash
   pip install svetlanna
   ```
5. Установите PyTorch (см. инструкции на официальном [сайте](https://pytorch.org/get-started/locally/)). Список команд для установки версий, отличных от последней, можно найти [тут](https://pytorch.org/get-started/previous-versions/).
   Функции библиотеки протестированы на версиях PyTorch от `2.3.0` до `2.7.1` включительно. Выберите подходящий вариант установки в зависимости от вашей системы. Установка включает в себя установку модулей `torch`, `torchvision`, `torchaudio`. Для работы с GPU требуется соответствующая видеокарта и поддерживаемая сборка PyTorch. 
   При использовании GPU с поддержкой CUDA обратите внимание, что на компьютере **должна быть установлена версия CUDA, которая соответствует выбранной версии PyTorch**. Таблица соответствия версий PyTorch и версий CUDA:
   |PyTorch|CUDA|
   |-|-|
   |`2.3.0` | `11.8` `12.1`
   |`2.3.1` | `11.8` `12.1`
   |`2.4.0` | `11.8` `12.1` `12.4`
   |`2.4.1` | `11.8` `12.1` `12.4`
   |`2.5.0` | `11.8` `12.1` `12.4`
   |`2.5.1` | `11.8` `12.1` `12.4`
   |`2.6.0` | `11.8`      `12.4` `12.6`
   |`2.7.0` | `11.8`          `12.6` `12.8`
   |`2.7.1` | `11.8`           `12.6` `12.8`

   Список команд для установки версий, отличных от последней, можно найти [тут](https://pytorch.org/get-started/previous-versions/), например:
   | Видеокарта | CUDA | PyTorch | Команда для установки |
   |------------|------|-|-------------------|
   |Nvidia GTX 970|`11.8`|`2.7.1`|`pip install torch==2.7.1 torchvision==0.22.1 torchaudio==2.7.1 --index-url https://download.pytorch.org/whl/cu118`|
   |Nvidia GTX 1060|`11.8`|`2.7.1`|`pip install torch==2.7.1 torchvision==0.22.1 torchaudio==2.7.1 --index-url https://download.pytorch.org/whl/cu118`|
   |Nvidia RTX 4060|`12.8`|`2.7.1`|`pip install torch==2.7.1 torchvision==0.22.1 torchaudio==2.7.1 --index-url https://download.pytorch.org/whl/cu128`|
6. Установите Jupyter notebook в ваше виртуальное окружение:
   ```bash
   pip install notebook
   ```
   На Unix системах может быть так, что Jupyter notebook уже установлен в системе и его невозможно установить в виртуальное окружение. В этом случае установите ядро `ipykernel` внутри вашего виртуального окружения:
   ```bash
   pip install ipykernel
   ```
   Далее добавьте ваше виртуальное окружение в качестве ядра в Jupyter notebook, следуя [инструкции](https://ipython.readthedocs.io/en/stable/install/kernel_install.html). Скорее всего, достаточно использовать команду
   ```bash
   python -m ipykernel install --user
   ```
7. Установите дополнительные пакеты:
   ```bash
   pip install reservoirpy matplotlib tqdm requests av scikit-image py-cpuinfo gputil pandas
   ```
8. Запустите Jupyter notebook и откройте страницу в браузере (см. “Or copy and paste one of these URLs:” в терминале после следующей команды):
   ```bash
   jupyter notebook
   ```
9. В интерфейсе Jupyter notebook перейдите в папку проекта SVETlANNa.docs. Примеры разделены по тематическим подпапкам в виде .ipynb файлов. Для запуска примера требуется
   1. открыть нужный файл в интерфейсе Jupyter notebook;
   2. убедиться, что **выбрано нужное ядро**, которое соответствует использованному виртуальному окружению. В случае, если Jupyter notebook был установлен и запущен в виртуальном окружении, ядро автоматически будет соответствовать виртуальному окружению. В случае, если виртуальное окружение было добавлено как ядро (см. выше), его необходимо выбрать в соответствующем меню в интерфейсе Jupyter notebook.
   Ошибки вида `error: externally-managed-environment` при попытке запустить ячейку, содержащую `%pip`, сигнализируют о том, что выбрано ядро, которое относится к глобальному окружению. Убедитесь, что выбрано нужное ядро. Если не сделали ранее, попробуйте добавить виртуальное окружение в качестве ядра (см. выше);
   3. выполнить поочередно все ячейки с кодом (комбинация клавиш Shift+Enter). 

## Запуск примеров с установленной из исходников библиотекой SVETlANNa

1. Клонируйте репозиторий (должен быть установлен [git](https://git-scm.com)):
   ```bash
	 git clone https://github.com/CompPhysLab/SVETlANNa.docs.git 
   ```
   Дальнейшие команды выполняются при активированном виртуальном окружении, которое ранее использовалось при установке библиотеки SVETlANNa из исходников.
2. Установите Jupyter notebook в ваше виртуальное окружение:
   ```bash
   pip install notebook
   ```
   На Unix системах может быть так, что Jupyter notebook уже установлен в системе и его невозможно установить в виртуальное окружение. В этом случае установите ядро `ipykernel` внутри вашего виртуального окружения:
   ```bash
   pip install ipykernel
   ```
   Далее добавьте ваше виртуальное окружение в качестве ядра в Jupyter notebook, следуя [инструкции](https://ipython.readthedocs.io/en/stable/install/kernel_install.html). Скорее всего, достаточно использовать команду
   ```bash
   python -m ipykernel install --user
   ```
3. Установите дополнительные пакеты:
   ```bash
   pip install reservoirpy matplotlib tqdm requests av scikit-image py-cpuinfo gputil pandas
   ```
4. Запустите Jupyter notebook и откройте страницу в браузере (см. “Or copy and paste one of these URLs:” в терминале после следующей команды):
   ```bash
   jupyter notebook
   ```
5. В интерфейсе Jupyter notebook перейдите в папку проекта SVETlANNa.docs. Примеры разделены по тематическим подпапкам в виде .ipynb файлов. Для запуска примера требуется
   1. открыть нужный файл в интерфейсе Jupyter notebook;
   2. убедиться, что **выбрано нужное ядро**, которое соответствует использованному виртуальному окружению. В случае, если Jupyter notebook был установлен и запущен в виртуальном окружении, ядро автоматически будет соответствовать виртуальному окружению. В случае, если виртуальное окружение было добавлено как ядро (см. выше), его необходимо выбрать в соответствующем меню в интерфейсе Jupyter notebook.
   Ошибки вида `error: externally-managed-environment` при попытке запустить ячейку, содержащую `%pip`, сигнализируют о том, что выбрано ядро, которое относится к глобальному окружению. Убедитесь, что выбрано нужное ядро. Если не сделали ранее, попробуйте добавить виртуальное окружение в качестве ядра (см. выше);
   3. выполнить поочередно все ячейки с кодом (комбинация клавиш Shift+Enter). 

# Примеры

Ниже показан пример результата обучения оптической нейронной сети для задачи классификации MNIST: изображение цифры «8» пропускается через стек из 10 фазовых пластин с оптимизированными функциями пропускания. Выбранные области детектора соответствуют разным распознаваемым цифрам. Класс распознаваемой цифры определяется областью детектора, измеряющей максимальную оптическую интенсивность.

Примеры визуализации оптической установки и полей в срезе пучка:

<img src="./pics/visualization.png" alt="drawing" width="400"/>

Example a of five-layer DONN trained to recognize numbers from the MNIST database:

<img src="./pics/MNIST example 1.png" alt="drawing" width="400"/>

<img src="./pics/MNIST example 2.png" alt="drawing" width="400"/>

<img src="./pics/MNIST example 3.png" alt="drawing" width="400"/>

# Вклад в разработку

Улучшение библиотеки и разработка новых модулей приветствуются (см. файлы `contributing.md`).

# Бладарности

Работа над данным проектом была поддержана [Фондом содействия инновациям](https://en.fasie.ru/)

# Авторы

- [@aashcher](https://github.com/aashcher)
- [@alexeykokhanovskiy](https://github.com/alexeykokhanovskiy)
- [@Den4S](https://github.com/Den4S)
- [@djiboshin](https://github.com/djiboshin)
- [@Nevermind013](https://github.com/Nevermind013)

# Лицензия

[Mozilla Public License Version 2.0](https://www.mozilla.org/en-US/MPL/2.0/)
